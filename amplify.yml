version: 1
frontend:
  phases:
    preBuild:
      commands:
        - "if ! npm ls typescript >/dev/null 2>&1; then npm install --save-dev typescript @types/react @types/node; fi"
        - "npm ci --include=dev"
        - echo "Node version:"
        - node -v
        - nvm install 20
        - nvm use 20
        - echo "Current node:"
        - node -v
        - echo "Current npm:"
        - npm -v
        - echo "Cleaning up..."
        - rm -rf node_modules .next
        - npm ci
        - echo "âœ… Dependencies installed successfully"

    build:
      commands:
        - echo "ðŸš€ Building Next.js project..."
        - export NEXT_TELEMETRY_DISABLED=1
        - export NODE_OPTIONS="--max_old_space_size=4096"
        - echo "NEXT_PUBLIC_API_BASE_URL=$NEXT_PUBLIC_API_BASE_URL" > .env.production
        - echo ".env.production:"
        - cat .env.production
        - npm run build

  artifacts:
    baseDirectory: .next
    files:
      - "**/*"

  cache:
    paths:
      - node_modules/**/* 
      - .next/cache/**/*
