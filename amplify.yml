version: 1
frontend:
  phases:
    preBuild:
      commands:
        - echo "ðŸ”§ Menginstal TypeScript dan definisi types..."
        - npm install --save-dev typescript @types/react @types/node

        - echo "ðŸ§¹ Membersihkan cache..."
        - rm -rf node_modules .next
        - npm ci --include=dev

        - echo "âœ… Dependencies siap."

    build:
      commands:
        - echo "ðŸš€ Building Next.js project..."
        - export NEXT_TELEMETRY_DISABLED=1
        - export NODE_OPTIONS="--max_old_space_size=4096"
        - echo "NEXT_PUBLIC_API_BASE_URL=$NEXT_PUBLIC_API_BASE_URL" > .env.production
        - cat .env.production
        - npm run build

  artifacts:
    baseDirectory: .next
    files:
      - "**/*"

  cache:
    paths:
      - "node_modules/**/*"
      - ".next/cache/**/*"
